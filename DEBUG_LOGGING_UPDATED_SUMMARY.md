# –†–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ)

## –ó–∞–¥–∞—á–∞

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π DEBUG —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤—Å–µ JSON-–¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ—Ö–æ–¥—è—â–∏–µ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å: –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞, –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º –∏ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –æ—Ç–ª–æ–≤–∏—Ç—å —Ä–µ–¥–∫–∏–π –±–∞–≥.

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –†–∞—Å—à–∏—Ä–µ–Ω `JsonFormatter` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ DEBUG –ø–æ–ª–µ–π
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `setup_logging()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ `debug.log`
- –î–æ–±–∞–≤–ª–µ–Ω–æ —á—Ç–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `LOG_LEVEL`

### 2. –¢–æ—á–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
–î–æ–±–∞–≤–ª–µ–Ω–æ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤:
- **Middleware** (`src/api/middleware.py`) - –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- **ChatService** (`src/services/chat_service/chat_service.py`) - –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã —á–∞—Ç–∞
- **EmbeddingService** (`src/services/embedding_service.py`) - –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- **TranscriptionService** (`src/services/transcription_service.py`) - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç—ã
- **BaseProvider** (`src/providers/base.py`) - –∑–∞–ø—Ä–æ—Å—ã –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º –∏ –∏—Ö –æ—Ç–≤–µ—Ç—ã
- **OpenAI Provider** (`src/providers/openai.py`) - –ø–æ–ª–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã –∫ OpenAI

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `LOG_LEVEL` –≤ —Ñ–∞–π–ª `.env`
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —É—Ä–æ–≤–µ–Ω—å `INFO`
- –ü—Ä–∏ `LOG_LEVEL=DEBUG` —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `logs/debug.log`

### 4. –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
–ö–∞–∂–¥—ã–π DEBUG –ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç:
- `debug_json_data` - –ø–æ–ª–Ω—ã–µ JSON –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `debug_data_flow` - –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö (incoming/outgoing/to_provider/from_provider)
- `debug_component` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–≤—à–∏–π –ª–æ–≥
- `request_id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞

## üêõ –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: "—Å—ä–µ–¥–∞–Ω–∏–µ" –ø–µ—Ä–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –≤ —Å—Ç—Ä–∏–º–∏–Ω–≥–µ

### –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–≤—ã–π chunk —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ "—Å—ä–µ–¥–∞–µ—Ç—Å—è" –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –∫–ª–∏–µ–Ω—Ç–∞.

### –ü—Ä–∏—á–∏–Ω–∞
–í —Ñ–∞–π–ª–µ `src/services/chat_service/chat_service.py` –≤ —Å—Ç—Ä–æ–∫–∞—Ö 260-264:

```python
# –î–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –ª–æ–≥–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π chunk –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
first_chunk = None
async for chunk in response_data.body_iterator:
    first_chunk = chunk.decode('utf-8')
    break  # <-- –ü—Ä–æ–±–ª–µ–º–∞: –º—ã –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ chunk
```

### –†–µ—à–µ–Ω–∏–µ
–ù—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ–¥ –Ω–∞ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (—Å–º. `docs/debug_logging_streaming_fix.md`):

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π):**
```python
# –î–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –Ω–µ –ª–æ–≥–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π chunk, —á—Ç–æ–±—ã –Ω–µ "—Å—ä–µ–¥–∞—Ç—å" –µ–≥–æ
# –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –ª–æ–≥–∏—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞
if logger.isEnabledFor(logging.DEBUG):
    logger.debug(
        "DEBUG: Streaming Response Started",
        extra={
            "debug_json_data": {
                "streaming": True,
                "model": requested_model,
                "request_id": request_id
            },
            "debug_data_flow": "from_provider",
            "debug_component": "chat_service",
            "request_id": request_id
        }
    )
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í–∫–ª—é—á–µ–Ω–∏–µ
```bash
# –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
export LOG_LEVEL=DEBUG
python -m uvicorn src.api.main:app --reload

# –ò–ª–∏ —á–µ—Ä–µ–∑ .env —Ñ–∞–π–ª
LOG_LEVEL=DEBUG
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏
tail -f logs/app.log

# DEBUG –ª–æ–≥–∏ —Å –ø–æ–ª–Ω—ã–º–∏ JSON –¥–∞–Ω–Ω—ã–º–∏
tail -f logs/debug.log
```

### –ü–æ–∏—Å–∫
```bash
# –ü–æ–∏—Å–∫ –ø–æ request_id
grep "request_id\":\"your-request-id\" logs/debug.log

# –ü–æ–∏—Å–∫ –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É
grep "debug_component\":\"chat_service\" logs/debug.log
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã:
```bash
python test_debug_simple.py
```

–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É INFO –∏ DEBUG —Ä–µ–∂–∏–º–∞–º–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ debug.log

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: DEBUG –ª–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–∫–ª—é—á–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–π —Å—Ä–µ–¥–µ
- –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –†–µ–≥—É–ª—è—Ä–Ω–æ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏

## –§–∞–π–ª—ã

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `src/logging/config.py` - —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `src/api/middleware.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- `src/services/chat_service/chat_service.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å—Ç—Ä–∏–º–∏–Ω–≥–∞)
- `src/services/embedding_service.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `src/services/transcription_service.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `src/providers/base.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
- `src/providers/openai.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- `.env` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è LOG_LEVEL

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `docs/debug_logging_design.md` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- `docs/debug_logging_flow_diagram.md` - –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- `docs/debug_logging_implementation_guide.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- `docs/debug_logging_streaming_fix.md` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å—Ç—Ä–∏–º–∏–Ω–≥–∞
- `tests/test_debug_logging.py` - —Ç–µ—Å—Ç—ã –¥–ª—è pytest
- `test_debug_simple.py` - –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- `DEBUG_LOGGING_USAGE.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- `DEBUG_LOGGING_SUMMARY.md` - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ
- `DEBUG_LOGGING_UPDATED_SUMMARY.md` - —ç—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Ä–µ–∑—é–º–µ

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**:
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –≤—Å–µ JSON-–¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –°–æ–∑–¥–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª debug.log
- –ï—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ

‚ö†Ô∏è **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–º**:
- –ü–µ—Ä–≤—ã–π chunk —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ "—Å—ä–µ–¥–∞–µ—Ç—Å—è" –ø—Ä–∏ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏
- –ù—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑ `docs/debug_logging_streaming_fix.md`

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–±–ª–µ–º—ã —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –≤ `src/services/chat_service/chat_service.py`
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–µ—Ä–≤—ã–π —Ç–æ–∫–µ–Ω –±–æ–ª—å—à–µ –Ω–µ "—Å—ä–µ–¥–∞–µ—Ç—Å—è"

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å–∏—Å—Ç–µ–º–∞ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–ª—è –æ—Ç–ª–æ–≤–∞ —Ä–µ–¥–∫–∏—Ö –±–∞–≥–æ–≤.